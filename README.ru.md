# Плагин для навигации по таблицам Markdown

**На других языках**: [English](README.md)

Плагин **Markdown Table Navigation (mdtn)** — это плагин для Neovim, который позволяет перемещаться по ячейкам Markdown таблиц с помощью сочетаний клавиш. По умолчанию используются клавиши `<Tab>` и `<S-Tab>` для перемещения вперед и назад между ячейка соответственно. Плагин также может выделять ячейки при перемещении, предоставляет текстовые объекты для манипуляций с ячейками и позволяет легко перемещаться в начало/конец ячейки.

## Возможности

- **Навигация по столбцам**: Перемещение между столбцами в таблице Markdown с использованием `<Tab>` и `<S-Tab>`.
- **Опции выделения**: Возможность выделять ячейки, включая или исключая пробелы в начале и конце ячеек.
- **Текстовые объекты**:
  - `ac`: Выделяет ячейку в таблице включая пробелы в начале и конце ячейки.
  - `ic`: Выделяет только текст в ячейку, без пробелов в начале и конце.
- **Навигация по ячейкам**:
  - `[c`: Перейти в начало текущей ячейки.
  - `]c`: Перейти в концу текущей ячейки.
- **Настраиваемые сочетания клавиш**: Настройка собственных сочетаний клавиш для навигации.
- **Глобальное и побуферное управление**: Включение или отключение плагина глобально или для конкретных буферов.
- **Команды**: Предоставляет команды для ручной навигации и управления поведением плагина.

## Установка

Используйте ваш предпочтительный менеджер плагинов для Neovim, чтобы установить плагин. Например, с помощью [folke/lazy.nvim](https://github.com/folke/lazy.nvim):

```lua
{
	"bosha/md-table-navigation.nvim",
	config = function()
		require("mdtn").setup()
	end,
},
```

## Конфигурация

Плагин можно настроить, передав таблицу в функцию `setup`. Ниже приведены параметры по умолчанию:

```lua
require("mdtn").setup({
  enabled = true, -- Включить плагин по умолчанию
  select_on_navigate = false, -- Выделять ячейки при навигации
  select_whole_column = false, -- Выделять всю ячейку (включая начальные и конечные пробелы) при навигации
  filetypes = { "markdown" }, -- Типы файлов, для которых включен плагин
  inside_cell_pattern = "ic", -- Шаблон текстового объекта для выделения текста внутри ячейки (исключая пробелы)
  around_cell_pattern = "ac", -- Шаблон текстового объекта для выделения ячейки (включая пробелы)
  keybindings = {
    n_move_forward = "<Tab>", -- Сочетание клавиш для перемещения вперед в нормальном режиме
    n_move_backward = "<S-Tab>", -- Сочетание клавиш для перемещения назад в нормальном режиме
    i_move_forward = "<Tab>", -- Сочетание клавиш для перемещения вперед в режиме вставки
    i_move_backward = "<S-Tab>", -- Сочетание клавиш для перемещения назад в режиме вставки
    n_jump_to_cell_start = "[c", -- Сочетание клавиш для перехода к началу текущей ячейки в нормальном режиме
    n_jump_to_cell_end = "]c", -- Сочетание клавиш для перехода к концу текущей ячейки в нормальном режиме
  },
})
```

## Использование

### Сочетания клавиш

По умолчанию плагин использует следующие сочетания клавиш:

- **Нормальный режим**:
  - `<Tab>`: Перейти к следующему столбцу.
  - `<S-Tab>`: Перейти к предыдущему столбцу.
  - `[c`: Перейти к началу текущей ячейки.
  - `]c`: Перейти в конец текущей ячейки.
- **Режим вставки**:
  - `<Tab>`: Перейти к следующему столбцу.
  - `<S-Tab>`: Перейти к предыдущему столбцу.

### Текстовые объекты

Плагин предоставляет следующие команды для ручной навигации и управления:

- **`ac`**: Выделяет ячейку включая пробелы в начале и конце.
  - Пример: `dac` удалит содержимое ячейки включая пробелы в начале и конце, `yac` скопирует в регистр содержимое также с пробелами.
- **`ic`**: Выделяет только текст внутри ячейки исключая пробелы в начале и конце.
  - Пример: `dic` удалит только текст ячейки оставив пробелы в начале и конце, `yic` скопирует только текст ячейки.

#### Поддерживаемые действия

Текстовые объекты (text objects) работают со следующими действиями:

- `d`: Удаление
- `y`: Копирование
- `c`: Изменение
- `gU`: Преобразование в верхний регистр
- `gu`: Преобразование в нижний регистр

Примеры:

- Преобразовать ячейку в верхний регистр: `gUac`
- Преобразовать текст внутри ячейки в нижний регистр: `guic`

**Примечание**: Количественные префиксы перед текстовыми объектами (например, `2dac`) **не поддерживаются**.

### Настройка шаблонов текстовых объектов

Если стандартные шаблоны текстовых объектов (`ac` и `ic`) конфликтуют с другими плагинами, вы можете настроить их в конфигурации:

```lua
require("mdtn").setup({
  inside_cell_pattern = "ic", -- Измените на предпочтительный шаблон для выделения текста внутри ячейки
  around_cell_pattern = "ac", -- Измените на предпочтительный шаблон для выделения ячейки
})
```

### Команды

Плагин предоставляет следующие команды для ручной навигации и управления:

#### Команды навигации

- **`MDTableNavMoveForward [select=<bool>] [whole_col=<bool>]`**:

  - Перейти к следующему столбцу.
  - Необязательные аргументы:
    - `select=true|false`: Выделять ли ячейку при навигации.
    - `whole_col=true|false`: Включать ли начальные и конечные пробелы в выделение.

- **`MDTableNavMoveBackward [select=<bool>] [whole_col=<bool>]`**:
  - Перейти к предыдущему столбцу.
  - Необязательные аргументы: аналогичны команде **MDTableNavMoveForward**.

#### Команды управления

- **`MDTableNavEnable`**: Включить плагин глобально.
- **`MDTableNavDisable`**: Отключить плагин глобально.
- **`MDTableNavToggle`**: Переключить состояние плагина глобально.
- **`MDTableNavBufEnable`**: Включить плагин для текущего буфера.
- **`MDTableNavBufDisable`**: Отключить плагин для текущего буфера.
- **`MDTableNavBufToggle`**: Переключить состояние плагина для текущего буфера.

## Примеры

### Базовая навигация

1. Откройте файл Markdown с таблицей.
2. Используйте `<Tab>` для перехода к следующему столбцу и `<S-Tab>` для перехода к предыдущему.

### Навигация внутри ячейки

- Перейти к началу текущей ячейки: `[c`
- Перейти к концу текущей ячейки: `]c`

### Выделение ячеек

Чтобы выделять ячейки при навигации, включите параметр `select_on_navigate` в конфигурации:

```lua
require("mdtn").setup({
  select_on_navigate = true,
})
```

Теперь при использовании `<Tab>` или `<S-Tab>` ячейка будет выделяться.

### Выделение пробелов в начале и конце ячейки

Чтобы выделять пробелы в начале и конце ячейки, включите параметр `select_whole_column` в конфигурации:

```lua
require("mdtn").setup({
  select_on_navigate = true,
  select_whole_column = true,
})
```

Теперь при навигации будет выделяться вся ячейка (включая пробелы в начале и конце ячейки). Если `select_whole_column` установлен в `false`, будет выделяться только текстовое содержимое (без начальных и конечных пробелов).

### Использование текстовых объектов

Используйте текстовые объекты ac и ic для работы с ячейками таблиц:

- **Удалить содержимое текущей ячейки включая пробелы в начале и конце**:
  ```vim
  dac
  ```
- **Скопировать содержимое текущей ячейки без пробелов в начале и конце**:
  ```vim
  yic
  ```
- **Изменить текст внутри текущей ячейки**:
  ```vim
  cic
  ```
- **Преобразовать текст внутри ячейки в верхний регистр**:
  ```vim
  gUac
  ```
- **Преобразовать текст внутри ячейки в нижний регистр**:
  ```vim
  guic
  ```

### Использование команд

Вы можете вручную управлять навигацией и состоянием плагина с помощью команд:

```vim
:MDTableNavMoveForward select=true whole_col=true
:MDTableNavMoveBackward select=false
:MDTableNavToggle
```

Используйте эти команды, если хотите настроить более сложные сочетания клавиш для ваших сценариев.

## Настройка сочетаний клавиш

Чтобы настроить сочетания клавиш, передайте предпочтительные клавиши в функцию `setup`:

```lua
require("mdtn").setup({
  keybindings = {
    n_move_forward = "<C-l>", -- Использовать Ctrl+l для перемещения вперед в нормальном режиме
    n_move_backward = "<C-h>", -- Использовать Ctrl+h для перемещения назад в нормальном режиме
    i_move_forward = "<C-l>", -- Использовать Ctrl+l для перемещения вперед в режиме вставки
    i_move_backward = "<C-h>", -- Использовать Ctrl+h для перемещения назад в режиме вставки
    n_jump_to_cell_start = "[c", -- Настройка сочетания клавиш для перехода к началу текущей ячейки
    n_jump_to_cell_end = "]c", -- Настройка сочетания клавиш для перехода к концу текущей ячейки
  },
})
```

## Устранение неполадок

- **Плагин не работает**: Убедитесь, что плагин включен глобально и для текущего буфера. Используйте команды `:MDTableNavEnable` или `:MDTableNavBufEnable`, чтобы включить его.
- **Конфликт сочетаний клавиш**: Если сочетания клавиш по умолчанию конфликтуют с другими плагинами, настройте их с помощью параметра `keybindings`.
- **Конфликты текстовых объектов**: Если шаблоны `ac` или `ic` конфликтуют с другими плагинами, настройте их с помощью опций `inside_cell_pattern` и `around_cell_pattern`.


## Лицензия

Этот плагин лицензирован по лицензии MIT. Подробности см. в файле [LICENSE](LICENSE).
